import{j as e,R as ht,r as m,L as G,e as W,o as f,a as R,s as d,c as Y,b as Fe,d as Be,n as T,f as Me,u as xt,i as ve,v as B,g as fe,h as Ue,k as ye,l as we,m as Ge,K as gt,p as ft,q as bt,H as jt,t as vt,w as z,x as $e}from"./chunks/vendor-DEiZjHmj.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const yt=()=>e.jsxs("svg",{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"40px",viewBox:"0 0 1024 976",enableBackground:"new 0 0 1024 976",xmlSpace:"preserve",children:[e.jsx("path",{fill:"currentColor",opacity:"1.000000",stroke:"none",d:`
M775.263306,608.000000
	C775.266174,649.996033 775.793823,691.501038 775.079773,732.984741
	C774.628967,759.176331 762.616089,779.679871 740.015869,793.566040
	C726.498962,801.871216 711.846619,805.510620 695.969299,805.448792
	C646.474854,805.256104 596.979126,805.377197 547.483887,805.379639
	C540.135132,805.380005 540.088318,805.388367 540.208496,812.932678
	C540.426025,826.583557 539.449158,840.257751 540.989746,853.882751
	C541.136963,855.184326 541.328674,856.480896 541.622742,858.714172
	C545.726807,855.329651 549.231812,852.205139 552.977722,849.402588
	C559.164734,844.773682 565.938965,844.231567 572.621399,848.011658
	C578.794312,851.503357 581.531738,857.292236 581.273254,864.313538
	C581.107483,868.817078 578.931152,872.653198 575.852539,875.785828
	C562.421448,889.452515 548.944641,903.075684 535.357300,916.586792
	C528.483337,923.422302 517.862183,923.561035 511.097900,916.856995
	C497.024170,902.908508 483.062988,888.844971 469.171783,874.714478
	C463.889069,869.340820 463.190826,861.460938 466.875061,853.943909
	C469.431580,848.727844 476.341583,845.102478 482.819000,845.882080
	C487.795776,846.481018 491.710114,849.356628 495.413727,852.515991
	C498.049835,854.764771 500.704773,856.991455 503.309723,859.192871
	C505.445679,857.862793 504.712616,856.018433 504.718353,854.509521
	C504.772644,840.177856 504.563538,825.842590 504.825134,811.515625
	C504.913513,806.675964 503.326447,805.283508 498.545990,805.296936
	C447.717926,805.439697 396.889252,805.423218 346.060883,805.357788
	C312.335785,805.314392 285.111969,786.041504 273.787323,754.226685
	C271.111847,746.710388 269.585449,738.982666 269.602234,730.880371
	C269.713135,677.385742 269.658234,623.890747 269.652985,570.395874
	C269.652283,563.257080 269.640472,563.197205 262.395569,563.265320
	C243.071213,563.447021 223.716568,564.409302 204.436752,563.587646
	C195.161392,563.192383 190.636093,565.794189 185.816208,573.845215
	C175.613007,590.888428 159.664658,597.806458 139.380569,596.709351
	C120.938843,595.711975 101.606812,580.351929 96.482796,562.471191
	C88.210693,533.604858 105.373375,503.947021 135.340591,499.025146
	C157.271469,495.423126 176.727402,504.136627 187.358185,524.147278
	C189.188721,527.592957 191.486786,529.157715 195.592468,529.124146
	C218.088730,528.940247 240.587296,529.049988 263.085052,529.028015
	C269.637970,529.021606 269.655426,528.975037 269.655426,522.245728
	C269.655273,428.254761 269.461700,334.263214 269.749786,240.273148
	C269.848419,208.094971 285.132355,184.917664 314.465912,171.473389
	C324.184875,167.018982 334.712494,164.998154 345.386719,164.942978
	C381.882324,164.754333 418.379395,164.855850 454.875885,164.836639
	C461.747467,164.833023 461.963257,164.801468 461.634308,157.896851
	C461.238892,149.596832 460.659058,141.386368 461.516174,133.010956
	C463.384521,114.754509 472.807037,101.693466 488.213623,92.855621
	C499.432159,86.420219 511.743927,82.649078 524.858887,83.771561
	C549.043091,85.841446 568.661194,95.496628 579.439880,118.660599
	C582.625122,125.505852 583.937988,132.878677 584.249023,140.370743
	C584.504639,146.526825 584.659546,152.723083 584.243652,158.859833
	C583.901611,163.905807 585.908325,164.967453 590.548767,164.948395
	C627.211243,164.797791 663.874756,164.836182 700.537781,164.902054
	C715.679688,164.929245 729.766663,168.973602 742.340271,177.400604
	C759.217041,188.711655 769.675354,204.136749 773.681458,224.474335
	C775.719116,234.819107 774.941162,244.950485 775.185730,255.166183
	C775.556580,270.655884 775.287231,286.160889 775.292969,301.659393
	C775.295959,309.631561 775.299011,309.647430 783.497314,309.652771
	C801.828857,309.664764 820.163208,309.486267 838.490112,309.779236
	C843.246948,309.855286 845.576111,308.133911 847.602051,304.019196
	C856.772278,285.394318 872.171326,275.431732 892.705383,275.941650
	C916.302856,276.527618 934.486206,292.712067 940.060181,315.201752
	C946.523499,341.280243 926.983154,369.294983 901.273865,374.301544
	C882.211304,378.013794 857.865784,368.694122 848.223694,348.746857
	C846.564331,345.314087 844.488831,344.263153 840.892090,344.286896
	C821.061462,344.417969 801.228149,344.490143 781.399231,344.271637
	C776.590088,344.218628 775.181702,345.717194 775.188721,350.531067
	C775.312805,436.187225 775.269775,521.843628 775.263306,608.000000
M736.148132,737.630310
	C737.131836,735.059204 736.820557,732.367249 736.820862,729.720398
	C736.839661,566.726013 736.708557,403.731384 737.010254,240.737549
	C737.048645,220.006226 720.917114,203.270538 699.543457,203.269485
	C582.214111,203.263718 464.884766,203.257690 347.555481,203.344803
	C343.274597,203.347992 338.737946,203.580444 334.756989,204.962906
	C314.105865,212.134369 308.215759,224.931458 307.761871,242.558670
	C306.294800,299.530090 307.859528,356.524719 307.581573,413.515198
	C307.068726,518.674011 307.400543,623.837036 307.447388,728.998352
	C307.449982,734.836853 309.007904,740.502563 311.318665,745.831848
	C317.789856,760.756348 330.505402,767.272644 345.563416,767.440002
	C396.888641,768.010620 448.224213,767.628784 499.555634,767.713379
	C503.452026,767.719788 504.803619,766.376221 504.785004,762.472778
	C504.679352,740.307495 504.720123,718.141113 504.843658,695.975769
	C504.862640,692.570679 503.819214,691.276855 500.261047,691.309448
	C483.429779,691.463806 466.596436,691.402344 449.763824,691.397339
	C437.222534,691.393616 425.040680,689.956848 413.227081,685.051147
	C390.788971,675.733398 372.692230,649.760681 372.685303,625.612305
	C372.660339,538.282104 372.552429,450.951599 372.797211,363.622070
	C372.840027,348.340424 379.096283,334.954651 388.963806,323.298462
	C404.589600,304.840302 425.437195,298.226105 448.636597,297.030273
	C451.593445,296.877869 453.159576,296.427460 454.045563,292.879974
	C459.593719,270.665100 469.905762,260.469482 495.439056,260.110870
	C514.768005,259.839386 534.103699,260.078033 553.436035,259.991882
	C558.193115,259.970703 562.615051,261.189484 566.920166,262.955170
	C579.473511,268.103729 586.693420,277.737976 589.338989,290.762909
	C590.306702,295.527344 592.375244,296.789703 597.214417,297.237610
	C608.373352,298.270477 619.453918,299.843628 630.021362,304.435089
	C655.852600,315.658661 671.968750,340.311462 672.098267,366.903778
	C672.500916,449.565704 672.274231,532.230774 672.221130,614.894653
	C672.216553,621.993591 672.158813,628.993286 670.632385,636.151672
	C667.063965,652.885498 658.776611,666.229492 645.393555,676.626343
	C631.068054,687.755432 614.432678,691.292542 596.772156,691.364868
	C580.439697,691.431702 564.106689,691.372314 547.774048,691.413635
	C540.313049,691.432495 540.108704,691.643921 540.101135,698.905518
	C540.079956,719.238098 540.097656,739.570740 540.091003,759.903320
	C540.088440,767.640442 540.077332,767.660339 547.615479,767.661743
	C591.280640,767.669739 634.946045,767.738953 678.610840,767.614807
	C688.538147,767.586548 698.413635,768.021118 708.392822,766.044250
	C721.075134,763.531860 734.098511,751.433960 736.148132,737.630310
M627.952515,640.379578
	C632.058289,634.262329 633.807495,627.444092 633.817871,620.156189
	C633.850525,597.158752 633.843018,574.161255 633.840576,551.163818
	C633.834045,490.003845 633.878479,428.843750 633.767395,367.683960
	C633.743469,354.513977 628.115295,344.773682 615.266174,339.883057
	C605.095825,336.012054 594.314514,335.529602 583.823853,335.603699
	C536.361389,335.938812 488.868866,333.509827 441.432465,337.031769
	C423.117065,338.391602 410.499176,350.604034 410.686890,368.339813
	C410.944336,392.664856 410.663605,416.980042 410.522156,441.302032
	C410.197418,497.127350 410.411285,552.955811 410.417358,608.783020
	C410.418121,615.912048 410.636932,622.962036 412.236389,630.028503
	C414.751587,641.140625 424.983032,651.360962 435.370148,651.958252
	C441.852814,652.330994 448.353363,652.603394 454.844574,652.578308
	C476.669922,652.494019 498.494598,652.122437 520.319641,652.111755
	C545.977966,652.099182 571.636292,652.384521 597.294861,652.468384
	C608.811584,652.506104 620.170959,651.953735 627.952515,640.379578
M536.671082,160.253250
	C539.136963,158.003555 541.673096,155.778992 543.245056,152.784210
	C545.409668,148.660324 547.690491,144.461334 546.287170,139.550415
	C542.527832,126.394737 531.606018,119.835258 519.202454,121.260841
	C505.599518,122.824280 496.319183,136.317810 500.914581,149.232727
	C505.406555,161.856964 521.037170,170.708313 536.671082,160.253250
z`}),e.jsx("path",{fill:"currentColor",opacity:"1.000000",stroke:"none",d:`
M477.087799,363.540771
	C499.039734,359.447479 520.796143,359.178101 542.563416,360.695190
	C554.099365,361.499207 565.616699,363.017731 577.038696,364.857819
	C585.158508,366.165955 593.299866,367.705658 601.147461,370.387177
	C603.072998,371.045135 604.047424,371.973541 604.385559,374.176849
	C605.980957,384.572723 606.304138,395.009430 606.192139,405.503326
	C606.044617,419.334412 606.200989,433.168457 606.150696,447.000946
	C606.049377,474.852386 594.774353,497.476685 573.724609,515.351013
	C564.591248,523.106567 554.870789,530.050659 544.307007,535.844788
	C529.692932,543.860535 515.193420,544.024658 500.658386,536.039429
	C479.635712,524.490051 461.084869,510.120728 449.123199,488.751282
	C442.379547,476.703796 438.661072,463.708160 438.685394,449.769501
	C438.727570,425.604065 438.744446,401.438538 438.749634,377.273071
	C438.750275,374.375702 438.595184,371.621582 442.283569,370.523010
	C453.550293,367.167267 464.936218,364.467102 477.087799,363.540771
M479.088165,426.434357
	C478.413727,425.946808 477.761566,425.424225 477.060516,424.978455
	C475.162476,423.771637 473.442444,421.352478 470.921173,422.714722
	C468.716278,423.906036 469.285950,426.539795 469.266174,428.648254
	C469.200653,435.638611 469.220337,442.629974 469.243103,449.620819
	C469.269928,457.858246 471.074280,465.720642 474.863342,473.014343
	C482.895905,488.476288 495.674072,499.118378 510.655396,507.331726
	C517.907654,511.307739 525.349548,512.086731 532.953918,507.743469
	C539.321167,504.106812 545.684570,500.451141 551.236145,495.667206
	C561.333618,486.966003 569.600647,476.899261 572.959717,463.609985
	C575.919312,451.900787 576.076721,439.955658 575.457947,427.994324
	C575.353455,425.974518 575.254944,423.656616 573.481750,421.963531
	C571.701843,422.082001 570.316101,422.999908 568.952759,423.938232
	C556.352722,432.610046 544.087219,441.735840 532.113464,451.250549
	C524.932434,456.956787 519.955017,456.841278 512.496704,451.185028
	C501.646698,442.956573 490.630219,434.947510 479.088165,426.434357
z`}),e.jsx("path",{fill:"currentColor",opacity:"1.000000",stroke:"none",d:`
M564.945679,621.292236
	C534.807678,621.288269 505.159790,621.141907 475.514435,621.353516
	C464.302002,621.433533 456.956696,614.303101 457.019714,602.680054
	C457.050201,597.065247 455.994843,591.342590 457.937042,585.833496
	C460.665497,578.094238 466.687622,573.771179 474.840942,573.764221
	C505.986847,573.737427 537.133545,573.617065 568.278198,573.812012
	C579.963013,573.885132 585.686279,579.717407 586.971680,589.773315
	C587.577759,594.514771 587.366760,599.433167 586.942383,604.219604
	C585.902832,615.943665 579.482117,622.243530 564.945679,621.292236
z`})]}),He=ht.createContext({}),Z=()=>m.use(He),wt=()=>{const[t,s]=m.useState(!1),a=m.useRef(null),{user:r,keycloak:n}=Z();async function o(){await(n==null?void 0:n.login())}async function i(){await(n==null?void 0:n.logout())}async function l(){await(n==null?void 0:n.accountManagement())}return m.useEffect(()=>{function h(p){a.current&&!a.current.contains(p.target)&&s(!1)}return t?document.addEventListener("mousedown",h):document.removeEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[t]),e.jsxs("div",{className:"relative",ref:a,children:[e.jsx("div",{className:"inline-block align-top p-2 pr-3",children:r==null?void 0:r.name}),e.jsx("button",{className:"p-2 rounded-full text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white transition-colors","aria-label":"Profile",onClick:()=>s(h=>!h),"data-testid":"profile-icon",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),t&&e.jsx("div",{className:"absolute right-0 mt-2 w-48 border border-gray-700 rounded-md shadow-lg py-2 z-50",style:{backgroundColor:"#1f2937"},children:r?e.jsxs("div",{className:"px-4 py-2 text-gray-200 text-sm",children:[e.jsx("div",{className:"font-semibold",children:r.name}),e.jsx("div",{className:"text-gray-400 text-xs",children:r.email}),e.jsx("button",{className:"bg-gray-700 text-left px-4 py-2 text-gray-200 hover:bg-gray-600 rounded-md text-sm transition-colors mt-2",style:{width:"calc(100% - 1rem)"},onClick:l,"data-testid":"logout-button",children:"Account"}),e.jsx("button",{className:"bg-gray-700 text-left px-4 py-2 text-gray-200 hover:bg-gray-600 rounded-md text-sm transition-colors mt-2",style:{width:"calc(100% - 1rem)"},onClick:i,"data-testid":"logout-button",children:"Logout"})]}):e.jsx("button",{className:"bg-gray-700 text-left px-4 py-2 text-gray-200 hover:bg-gray-600 rounded-md text-sm transition-colors mx-2",style:{width:"calc(100% - 1rem)"},onClick:o,"data-testid":"login-button",children:"Login / Register"})})]})},K=({external:t,to:s,...a})=>t?e.jsx("a",{...a,href:s}):e.jsx(G,{...a,to:s}),Le=[{label:"Browse Projects",to:"/",testId:"BrowseProjects"},{label:"Create Project",to:"/page/create-project",testId:"CreateProject"},{label:"My Projects",to:"/page/my-projects",testId:"MyProjects"},{label:"API Docs",to:"/api-docs",external:!0,testId:"APIDocs"}],Nt=({searchQuery:t,setSearchQuery:s})=>e.jsxs("div",{className:"relative hidden sm:block",children:[e.jsx("input",{type:"search",placeholder:"Search apps...",value:t,onChange:a=>s(a.target.value),"data-testid":"search-bar",className:"bg-gray-700 text-gray-300 placeholder-gray-500 rounded-md py-2 pl-3 pr-10 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]}),ee=t=>{const[s,a]=m.useState(!1),n=t.searchQuery!==void 0&&t.setSearchQuery!==void 0?t:void 0;return e.jsxs("header",{className:"bg-gray-800 shadow-md sticky top-0 z-50",children:[e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(K,{to:"/",className:"flex items-center space-x-2 text-xl font-semibold text-emerald-400 hover:text-emerald-300 transition-colors",children:[e.jsx(yt,{}),e.jsx("span",{children:"BadgeHub"})]})}),e.jsx("nav",{className:"hidden md:flex space-x-4 items-center",children:Le.map(o=>e.jsx(K,{to:o.to,external:o.external,"data-testid":"Header/Link/"+o.testId,className:(o.to.endsWith("/todo")?"todoElement ":"")+"text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors",children:o.label},o.label))}),e.jsxs("div",{className:"flex items-center space-x-3",children:[n&&e.jsx(Nt,{...n}),e.jsx(wt,{})]}),e.jsx("div",{className:"md:hidden flex items-center",children:e.jsxs("button",{id:"mobile-menu-button",className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white transition-colors","aria-label":"Open main menu","aria-expanded":s,onClick:()=>a(o=>!o),children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),e.jsx("svg",{className:`${s?"hidden":"block"} h-6 w-6`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})}),e.jsx("svg",{className:`${s?"block":"hidden"} h-6 w-6`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})})]})}),e.jsx("div",{className:`md:hidden${s?"":" hidden"}`,id:"mobile-menu",children:e.jsx("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:Le.map(o=>e.jsx(K,{to:o.to,external:o.external,className:"text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium transition-colors",children:o.label},o.label))})})]})},Ct=()=>e.jsxs("section",{className:"text-center mb-12 pt-8",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-slate-100 mb-4",children:"Share. Build. Innovate."}),e.jsx("p",{className:"text-lg text-slate-400 mb-8 max-w-2xl mx-auto",children:"Badge applications at your fingertips. Discover projects or contribute your own."}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx("a",{href:"#apps-grid",className:"btn-primary px-8 py-3 rounded-lg text-lg font-semibold shadow-lg hover:shadow-xl hover:text-white transition-all duration-200 ease-in-out transform hover:scale-105",children:"Explore Projects"}),e.jsx(K,{to:"/page/create-project",className:"btn-secondary px-8 py-3 rounded-lg text-lg font-semibold shadow-lg hover:shadow-xl hover:text-white transition-all duration-200 ease-in-out transform hover:scale-105",children:"Upload Your Creation"})]})]}),te=()=>{const t=new Date().getFullYear();return e.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 mt-16",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-slate-400",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("a",{href:"https://github.com/BadgeHubCrew/badgehub-app/blob/main/README.md",target:"_blank",className:"px-3 hover:text-emerald-400 transition-colors text-sm",children:"About"}),e.jsx("a",{href:"https://github.com/badgehubcrew/badgehub-app/issues",target:"_blank",className:"px-3 hover:text-emerald-400 transition-colors text-sm",children:"Contact"}),e.jsx("a",{href:"https://github.com/badgehubcrew",target:"_blank",rel:"noopener noreferrer",className:"px-3 hover:text-emerald-400 transition-colors text-sm",children:"GitHub"})]}),e.jsxs("p",{className:"text-sm font-mono",children:["© ",t," BadgeHub. All rights reserved."]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Designed for makers, by makers."})]})})},Et={BASE_URL:"/badgehub-app/pr-5/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BADGEHUB_API_BASE_URL:"https://example.invalid",VITE_BADGE_SLUGS:"fri3d-badge",VITE_BASE_PATH:"/badgehub-app/pr-5/",VITE_ENABLE_BROWSER_BACKEND:"true",VITE_KEYCLOAK_BASE_URL:"https://example.invalid",VITE_KEYCLOAK_CLIENT_ID:"badgehub",VITE_KEYCLOAK_REALM:"master"},_t="https://github.com/badgehubcrew/badgehub-app";function se(t){const s=Et[t];if(s==null||s==="")throw new Error(`Missing required frontend env: ${t}`);return s}function St(t){const a=se(t).split(",").map(r=>r.trim()).filter(Boolean);if(a.length===0)throw new Error(`Env ${t} must contain at least one non-empty value`);return a}const J="/badgehub-app/pr-5/",At=J.endsWith("/")?J.slice(0,-1):J,Lt=`${globalThis.location.origin}${At}`,xe=`${J}assets/no-icon-uploaded.png`,ze=`${J}assets/no-icon-uploaded.png`,Tt=se("VITE_KEYCLOAK_CLIENT_ID"),Pt=se("VITE_BADGEHUB_API_BASE_URL"),It=se("VITE_KEYCLOAK_BASE_URL"),Rt=se("VITE_KEYCLOAK_REALM"),Ve=St("VITE_BADGE_SLUGS"),Ne=Pt+"/api/v3";var de={};function ie(t){const s=de[t];if(s==null)throw new Error(`Environment variable [${t}] is not set and is required.`);return s}function kt(){var t,s,a;return{keycloakPublic:{KEYCLOAK_BASE_URL:ie("KEYCLOAK_BASE_URL"),KEYCLOAK_REALM:de.KEYCLOAK_REALM??"master",KEYCLOAK_CLIENT_ID:de.KEYCLOAK_CLIENT_ID??"badgehub-api-frontend"},BADGEHUB_API_BASE_URL:ie("BADGEHUB_API_BASE_URL"),BADGE_SLUGS:(t=ie("BADGE_SLUGS"))==null?void 0:t.split(","),CATEGORY_NAMES:[...(s=ie("CATEGORY_NAMES"))==null?void 0:s.split(",")],ADMIN_CATEGORY_NAMES:((a=de.ADMIN_CATEGORY_NAMES)==null?void 0:a.split(","))??["Default"],isDevEnvironment:!1}}const Ke=()=>globalThis.__SHARED_CONFIG__??kt(),be=Ke(),he=W(Ce());function Ce(){return[...be.CATEGORY_NAMES,...be.ADMIN_CATEGORY_NAMES]}function Ot(t){return be.ADMIN_CATEGORY_NAMES.includes(t)}const ae=W(Dt()).describe("badge slug");function Dt(){return Ke().BADGE_SLUGS}const Ft=f({revision:Y.number().int().nonnegative().optional().describe(`Revision of the project for this variant. If it is not present, then the revision of the project should be used.
Warning: if it is present, then badgehub clients on badges will not update the app unless the this revision number is increased.`),type:d().optional().describe("the type of the application variant, eg 'standalone', 'badge_vms', 'appfs', 'micropython', 'circuitpython', ..."),executable:d().optional().describe(`Path to the source_file path of the file that should be executed to launch an app.
If the executable property is not present, then it can be guessed by the badge firmware (eg. case of only one file with correct extension, or case of __init__.py file in micropython app.`),args:R(d()).optional(),assets:R(f({source_file:d().describe("Path to the source file, relative to the project root"),destination_file:d().optional().describe("Path to the destination file in the badge's filesystem")})).optional().describe(`List of assets that are part of the variant, with optionally an indication of how the files should be mapped on the badge. 
if the assets property is not present, then all project files should be considered part of the variant.`),badges:R(ae).optional().describe("list of badges that that this variant is made for. This should be subset of the badges in the top level appmetadata.json and it should not overlap with any other variants.")}),Bt=f({"8x8":d().optional(),"16x16":d().optional(),"32x32":d().optional(),"64x64":d().optional()}).describe(`Icon Map of the project that maps from accepted sizes to a file path. Icon format is quite strict because BadgeHub is the first user of these icons.
    Badge implementations can use these icons but they are not required to. For example if a badge's launcher an icon as an icon.py file, this file can still just be uploaded and the path could be indicated as custom property in the variant json.".`);Fe(ae,d().optional().describe("Path to the json file for this variant")).describe(`Map from badge slug to variant information, allows knowing if a variant is updated and where to find the json file for it.
This is used to determine if a variant is updated and where to find the json file for it.
The variant with the highest revision number determines the latest revision of the project.`);const Ye=f({project_type:W(["app","library","firmware","other"]).optional().describe("Type of the project, eg. 'app' or 'library'"),git_url:d().optional(),hidden:Be().describe("Whether the project should be hidden from the launcher and from discovery on BadgeHub. Note that this does not make it private, just harder to find.").optional(),name:d().optional().describe("name, we need this to show in the launcher and on badgehub."),description:d().optional().describe("Some more details about the app. Allows users to decide whether they want to install the app."),categories:R(he).optional().describe("Categories that the app falls into, eg. 'Event Related'. Categories are defined by the specific badgehub instance's config."),author:d().optional().describe("Name of the author of the project"),icon_map:Bt.optional(),license_file:d().optional().describe("Path to the License file. Default is LICENSE"),license_type:d().optional().describe("Short description of the license type, eg. 'MIT'"),version:d().optional().describe("Semantic version of the project"),badges:R(ae).optional().describe("list of badges that are compatible with this project."),application:R(Ft).optional().describe("A list of application variants that allows specifying badge-specific properties of the project")}),q=d().endsWith("Z"),qe=f({created_at:q,updated_at:q}),Mt=qe.extend({dir:d(),name:d(),ext:d(),mimetype:d(),image_width:T().optional(),image_height:T().optional(),size_of_content:T(),sha256:d().regex(/^[a-f0-9]{64}$/),size_formatted:d(),full_path:d(),url:d().url().describe("Url that should be used to download the file")}),Ut=f({revision:T(),files:R(Mt),app_metadata:Ye,published_at:q.optional().nullable(),project_slug:d().optional().nullable()});W(["working","in_progress","broken","unknown"]);const We=f({slug:d(),idp_user_id:d(),latest_revision:T().optional().nullable()}),je=We.extend({version:Ut}).extend(qe.shape),Gt=f({git:d().optional(),slug:d(),idp_user_id:d()}),$t=Ye,Ht=f({created_at:q,last_used_at:q}).describe("Metadata about the token."),le=f({full_path:d(),url:d().url()}),zt=f({"8x8":le.optional(),"16x16":le.optional(),"32x32":le.optional(),"64x64":le.optional()}).describe("Icon Map of the project that maps from accepted sizes to a file path and url."),Xe=We.extend({name:d(),hidden:Be().optional(),published_at:q.optional(),installs:T().describe("The number of badges that have reported to have installed this app at least once."),icon_map:zt.optional(),license_type:d().optional(),categories:R(he).optional(),badges:R(d()).optional(),description:d().optional(),revision:T(),git_url:d().optional()}),Vt="No Request Body for this request",pe=Me().optional().describe(Vt),Je=ve(),Te=Gt.omit({slug:!0,idp_user_id:!0}).describe("Schema request body for creating or updating a project"),_=f({reason:d()}),Ee=f({authorization:d().optional()}),D=xt([f({"badgehub-api-token":d().optional()}),Ee]),Qe=W(["8x8","16x16","32x32","64x64"]),Kt=f({filePath:d(),sizes:R(Qe).min(1)}),Yt=f({iconPaths:Fe(Qe,d())}),Ze=Je.router({createProject:{method:"POST",path:"/projects/:slug",pathParams:f({slug:d()}),body:Te,responses:{204:B(),409:_,403:_},summary:"Create a new project",headers:Ee},updateProject:{method:"PATCH",path:"/projects/:slug",pathParams:f({slug:d()}),body:Te,headers:D,responses:{204:B(),403:_,404:_},summary:"Update an existing project"},deleteProject:{method:"DELETE",path:"/projects/:slug",pathParams:f({slug:d()}),headers:D,responses:{204:B(),403:_,404:_},summary:"Delete an existing project"},writeDraftFile:{method:"POST",path:"/projects/:slug/draft/files/:filePath",contentType:"multipart/form-data",body:Me(),pathParams:f({slug:d(),filePath:d()}),headers:D,responses:{204:B(),403:_,404:_},summary:"Upload a file to the latest draft version of a project"},setDraftIconFromFile:{method:"POST",path:"/projects/:slug/draft/icon",pathParams:f({slug:d()}),body:Kt,headers:D,responses:{200:Yt,400:_,403:_,404:_},summary:"Set the 64x64 draft icon by converting the existing project file given in the body"},deleteDraftFile:{method:"DELETE",path:"/projects/:slug/draft/files/:filePath",pathParams:f({slug:d(),filePath:d()}),headers:D,responses:{204:B(),403:_,404:_},summary:"Delete a file from the latest draft version of a project"},changeDraftAppMetadata:{method:"PATCH",path:"/projects/:slug/draft/metadata",pathParams:f({slug:d()}),body:$t,headers:D,responses:{204:B(),403:_,404:_},summary:`Overwrite the metadata of the latest draft version of a project. 
This is actually just an alias for a post to /projects/:slug/draft/files/metadata.json`},getDraftFile:{method:"GET",path:"/projects/:slug/draft/files/:filePath",pathParams:f({slug:d(),filePath:d()}),headers:D,responses:{200:fe().describe("File content as a stream"),403:_,404:_},summary:"Get a file from the draft version of a project"},getDraftProject:{method:"GET",path:"/projects/:slug/draft",pathParams:f({slug:d()}),headers:D,responses:{200:je,403:_,404:_},summary:"Get project details for the draft version of a project"},publishVersion:{method:"PATCH",path:"/projects/:slug/publish",pathParams:f({slug:d()}),headers:D,responses:{204:B(),403:_,404:_},body:pe,summary:"Publish the current draft as a new version"},createProjectAPIToken:{method:"POST",path:"/projects/:slug/token",body:pe,headers:D,responses:{200:f({token:d()}).describe("An object containing the API token for the project."),403:_},summary:`Create a new API token for the project (and invalidate the old one if there was one).
This is an api key that can be used in the 'badgehub-api-token' header. Eg. set this header: 'badgehub-api-token:{token}'.`},getProjectApiTokenMetadata:{method:"GET",path:"/projects/:slug/token",headers:D,responses:{200:Ht,404:_,403:_},summary:"Allow to check if there is an API token for the project and when it was last used and created."},revokeProjectAPIToken:{method:"DELETE",path:"/projects/:slug/token",headers:D,responses:{204:B(),403:_},summary:"Delete the API token for the project"}},{baseHeaders:{authorization:d()}}),qt=Je.router({...Ze,getUserDraftProjects:{method:"GET",path:"/users/:userId/drafts",pathParams:f({userId:d()}),query:f({pageStart:Y.number().optional(),pageLength:Y.number().optional()}),responses:{200:R(Xe),403:_},summary:"Get all draft projects for a user",headers:Ee}}),Wt=f({slug:d(),revision:T()}),Xt=R(Wt),Jt=f({projects:T().describe("number of projects"),installs:T(),crashes:T(),launches:T(),installed_projects:T(),launched_projects:T(),crashed_projects:T(),authors:T().describe("number of project authors"),badges:T().describe("Number of registered badges")}),ne=ve(),$=f({reason:d()}),Qt=f({pageStart:Y.number().optional(),pageLength:Y.number().optional(),badge:ae.optional(),category:he.optional(),slugs:d().describe("optional comma separated list of project slugs to filter on").optional(),userId:d().optional(),search:d().max(50,"the search string should not be longer than 50 characters long").optional().describe("allow a text search over the apps' slug, name and descriptions"),orderBy:W(["published_at","installs"]).optional()}),Q=f({slug:d(),revision:Y.number()}),Zt=ne.router({getProject:{method:"GET",path:"/projects/:slug",pathParams:f({slug:d()}),responses:{200:je,404:$},summary:"Get (Latest) Project Details by Slug"},getProjectSummaries:{method:"GET",path:"/project-summaries",query:Qt,responses:{200:R(Xe)},summary:"Get all Projects"},getProjectLatestRevisions:{method:"GET",path:"/project-latest-revisions",query:f({slugs:d().optional()}),responses:{200:Xt},summary:"Get the latest revisions for a list of project slugs. Allows for quickly checking for updates."},getProjectLatestRevision:{method:"GET",path:"/project-latest-revisions/:slug",pathParams:f({slug:d()}),responses:{200:T()},summary:"Get the latest revision number for a project. Allows for quickly checking for updates."},getProjectForRevision:{method:"GET",path:"/projects/:slug/rev:revision",pathParams:Q,responses:{200:je,404:$},summary:"Get project details for a specific published revision of the project"}}),es=ne.router({getLatestPublishedFile:{method:"GET",path:"/projects/:slug/latest/files/:filePath",pathParams:f({slug:d(),filePath:d()}),responses:{200:fe().describe("ReadableStream"),404:$},summary:"Get the latest published revision of a file in the project"},getFileForRevision:{method:"GET",path:"/projects/:slug/rev:revision/files/:filePath",pathParams:Q.extend({filePath:d()}),responses:{200:fe().describe("ReadableStream"),404:$},summary:"Get a file for a specific revision of the project"}}),me=f({mac:d().describe("the mac address of the badge").optional(),id:d().describe("the id of the badge").optional()}),ts=ne.router({getCategories:{method:"GET",path:"/categories",responses:{200:R(he)}},getBadges:{method:"GET",path:"/badges",responses:{200:R(ae)}},ping:{method:"GET",path:"/ping",query:me,responses:{200:d().describe("Ping the server to check if it's alive")}},getStats:{method:"GET",path:"/stats",responses:{200:Jt}}}),ss=f({reason:d().describe("An optional reason for the app crash.").optional()}),as=ne.router({reportInstall:{method:"POST",path:"/projects/:slug/rev:revision/report/install",pathParams:Q,query:me,body:pe,responses:{204:B(),404:$},summary:"Report an installation of an app."},reportLaunch:{method:"POST",path:"/projects/:slug/rev:revision/report/launch",pathParams:Q,query:me,body:pe,responses:{204:B(),404:$},summary:"Report a launch of an app."},reportCrash:{method:"POST",path:"/projects/:slug/rev:revision/report/crash",pathParams:Q,query:me,body:ss,responses:{204:B(),404:$},summary:"Report a crash of an app."}}),ns=ne.router({...Zt,...es,...ts,...as}),rs=ve(),et=rs.router({...qt,...ns}),H=Ue(et,{baseUrl:Ne});async function os(t){return await(t==null?void 0:t.updateToken(30)),t==null?void 0:t.token}async function is(t){return{authorization:`Bearer ${await os(t)}`}}const k=async t=>{const s=await is(t);return Ue(et,{baseUrl:Ne,baseHeaders:s})},ge="All",_e=({title:t,noValueSetName:s,valueMap:a,value:r,onValueSelection:n})=>{const o=`${t.toLowerCase()}-dropdown`;return e.jsxs("div",{className:a?"":"todoElement",children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-slate-300 mb-1",children:t}),e.jsxs("select",{id:o,name:o,"data-testid":o,className:"w-full border-gray-600 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 p-2",value:r===void 0?ge:String(r),onChange:i=>n(i.target.value===ge?void 0:i.target.value),children:[e.jsx("option",{value:ge,children:s}),Object.keys(a??{}).map(i=>e.jsx("option",{value:i,children:a==null?void 0:a[i]},i))]})]})},ls=({category:t,onCategoryChange:s,noValueSetName:a})=>{const r=Object.fromEntries(Ce().map(n=>[n,n]));return e.jsx(_e,{noValueSetName:a,title:"Category",valueMap:r,value:t,onValueSelection:s})},cs=({badge:t,onBadgeChange:s,noValueSetName:a})=>{const n=Object.fromEntries(Ve.map(o=>[o,o]));return e.jsx(_e,{noValueSetName:a,title:"Badge",valueMap:n,value:t,onValueSelection:s})},ds=({badge:t,category:s,sortBy:a,onBadgeChange:r,onCategoryChange:n,onSortByChange:o,onResetFilters:i})=>e.jsx("section",{className:"mb-8 p-4 bg-gray-800 rounded-lg shadow","data-testid":"filter-bar",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(cs,{noValueSetName:"All",badge:t,onBadgeChange:r}),e.jsx(ls,{noValueSetName:"All",category:s,onCategoryChange:n}),e.jsx(_e,{title:"Sort By",noValueSetName:"Last Updated",onValueSelection:o,valueMap:{mostInstalled:"Most Installed"},value:a}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{className:"w-full btn-primary px-4 py-2 rounded-md text-sm font-semibold flex items-center justify-center",type:"button",onClick:i,children:[e.jsx("svg",{className:"h-4 w-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L13 10.414V15a1 1 0 01-.293.707l-2 2A1 1 0 019 17v-6.586L4.293 6.707A1 1 0 014 6V3z"})}),"Reset Filters"]})})]})}),ms=()=>e.jsx("div",{className:"flex justify-center items-center py-10","data-testid":"loading-spinner",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-400"})}),tt=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),us=({className:t="h-5 w-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true",className:t,children:e.jsx("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.67.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})}),ps=({className:t="h-5 w-5"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",className:t,children:e.jsx("path",{d:"M23.955 13.587l-1.34-4.145-2.736-8.455a.43.43 0 00-.814 0L16.33 9.44H7.67L4.935.987a.43.43 0 00-.814 0L1.385 9.44H1.38l-1.34 4.145a.961.961 0 00.343 1.144l11.04 8.01a.961.961 0 001.144 0l11.04-8.01a.961.961 0 00.343-1.144z"})});function hs(t,s){try{return new URL(t).hostname===s}catch{return!1}}const Se=({url:t,showText:s=!1})=>{var l;if(!t)return null;const r=(l=Object.entries({"github.com":{icon:us,name:"GitHub"},"gitlab.com":{icon:ps,name:"GitLab"}}).find(([h])=>hs(t,h)))==null?void 0:l[1];if(!r)return null;const{icon:n,name:o}=r,i={button:"btn-secondary px-4 py-2 rounded-lg text-sm font-semibold shadow-md hover:shadow-lg transition-all duration-200 flex items-center",icon:"text-slate-400 hover:text-white transition-colors ml-2 flex-shrink-0"};return e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:s?i.button:i.icon,"aria-label":`Source code repository on ${o}`,title:`View source code on ${o}`,children:[e.jsx(n,{className:"h-5 w-5"}),s&&e.jsx("span",{className:"ml-2",children:"View Source"})]})},xs=({name:t,description:s,categories:a,published_at:r,revision:n,badges:o,slug:i,icon_map:l,editable:h,installs:p,git_url:b})=>{const u=l==null?void 0:l["64x64"],x=u?u.url:xe,{keycloak:c}=Z(),[g,y]=m.useState(null),[P,I]=m.useState(!1);return m.useEffect(()=>{if(!x.includes("/draft/files/")){y(x);return}if(!(c!=null&&c.token)){y(xe);return}let N=!1,A=null;return I(!0),(async()=>{try{const S=await fetch(x,{headers:{Authorization:`Bearer ${c.token}`}});if(!S.ok)throw new Error(`HTTP ${S.status}`);if(N)return;const E=await S.blob(),w=URL.createObjectURL(E);A=w,y(w),I(!1)}catch(S){console.error("Failed to load authenticated icon:",S),N||(y(xe),I(!1))}})(),()=>{N=!0,A&&URL.revokeObjectURL(A)}},[x,c==null?void 0:c.token]),e.jsxs("div",{"data-testid":"AppCard",className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden card-hover-effect flex flex-col h-60",children:[e.jsxs("div",{className:"p-5 flex flex-col flex-grow",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center mr-4 flex-shrink-0 overflow-hidden",children:P||!g?e.jsx("div",{className:"w-8 h-8 bg-gray-600 animate-pulse rounded"}):e.jsx("img",{src:g,alt:t||"App icon",className:"w-8 h-8 object-contain",loading:"lazy",onError:j=>{j.currentTarget.src=ze}})}),e.jsxs("div",{className:"flex-grow flex items-center justify-between min-w-0",children:[e.jsx(K,{to:h?`/page/project/${i}/edit`:`/page/project/${i}`,className:"min-w-0",children:e.jsx("h3",{className:"text-xl font-semibold text-emerald-400 hover:text-emerald-300 transition-colors truncate",children:t})}),e.jsx(Se,{url:b})]})]}),e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed line-clamp-2",children:s}),e.jsx("div",{className:"mt-auto mb-3",children:(()=>{const N=[...(a==null?void 0:a.map((S,E)=>({text:S,type:"category",id:`category-${E}`})))??[],...(o==null?void 0:o.map((S,E)=>({text:S,type:"badge",id:`badge-${E}`})))??[]],A=N.slice(0,3),O=N.length-3;return e.jsxs(e.Fragment,{children:[A.map(S=>e.jsx("span",{className:`${S.type==="category"?"tag":"tag-mcu"} text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full`,children:S.text},S.id)),O>0&&e.jsxs("span",{className:"text-xs text-slate-500 font-medium cursor-help",title:N.slice(3).map(S=>S.text).join(", "),children:["+",O," more"]})]})})()})]}),e.jsxs("div",{className:"px-5 py-3 bg-gray-700 border-t border-gray-700 flex justify-between items-center",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Revision: ",n??"-"]}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Published:"," ",r?new Date(r).toLocaleDateString():"-"]}),p!==void 0&&e.jsxs("p",{className:"text-sm text-slate-400 flex items-center",children:[e.jsx(tt,{}),e.jsx("span",{className:"ml-1",children:p})]})]})]})},gs=({apps:t,editable:s})=>e.jsx(e.Fragment,{children:e.jsxs("section",{id:"apps-grid",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-6",children:"Badge Projects"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6","data-testid":"app-cards-container",children:t.length===0?e.jsx("div",{className:"col-span-full text-center text-slate-400 py-8",children:"No apps found."}):t.map(a=>e.jsx(xs,{...a,editable:s},a.slug))})]})}),fs=({currentPage:t,totalPages:s,onPageChange:a})=>{const r=Array.from({length:s},(n,o)=>o+1);return e.jsxs("nav",{className:"mt-10 flex justify-center gap-2","aria-label":"Pagination","data-testid":"pagination",children:[e.jsxs("button",{onClick:()=>t>1&&a(t-1),disabled:t===1,className:`relative inline-flex items-center px-2 py-2 rounded-l-md border text-sm font-medium transition-colors ${t===1?"border-gray-600 bg-gray-700 text-gray-500 cursor-not-allowed":"border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700"}`,"data-testid":"pagination-prev",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),r.map(n=>e.jsx("button",{onClick:()=>a(n),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium transition-colors ${n===t?"border-emerald-500 bg-emerald-600 text-white":"border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700"}`,"data-testid":`pagination-page-${n}`,children:n},n)),e.jsxs("button",{onClick:()=>t<s&&a(t+1),disabled:t===s,className:`relative inline-flex items-center px-2 py-2 rounded-r-md border text-sm font-medium transition-colors ${t===s?"border-gray-600 bg-gray-700 text-gray-500 cursor-not-allowed":"border-gray-700 bg-gray-800 text-gray-400 hover:bg-gray-700"}`,"data-testid":"pagination-next",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4-4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})},st=({appFetcher:t,searchQuery:s,editable:a=!1})=>{const[r,n]=m.useState([]),[o,i]=m.useState(!0),[l,h]=m.useState(null),[p,b]=m.useState(),[u,x]=m.useState(),[c,g]=m.useState(),[y,P]=m.useState(1),I=12;m.useEffect(()=>{i(!0),t({badge:p,category:u}).then(E=>{typeof E=="object"?(n(E),h(null)):h("Failed to fetch projects, invalid response type.")}).catch(E=>{console.error(E),h(E.message||"Failed to fetch projects")}).finally(()=>i(!1))},[p,u,t]);const j=m.useMemo(()=>{let E=r;return c==="mostInstalled"&&(E=[...r].sort((v,C)=>C.installs-v.installs)),s.trim()?E.filter(v=>{var C;return(C=v.name)==null?void 0:C.toLowerCase().includes(s.trim().toLowerCase())}):E},[r,s,c]),N=m.useMemo(()=>{const E=(y-1)*I;return j.slice(E,E+I)},[j,y]),A=E=>b(E),O=E=>x(E),S=()=>{b(void 0),x(void 0)};return e.jsxs(e.Fragment,{children:[!a&&e.jsx(ds,{badge:p,category:u,sortBy:c,onBadgeChange:A,onCategoryChange:O,onSortByChange:g,onResetFilters:S}),o?e.jsx(ms,{}):l?e.jsx("div",{"data-testid":"error-message",className:"text-center py-10 text-red-400",children:l}):e.jsx(gs,{apps:N,editable:a}),Math.ceil(j.length/I)>1&&e.jsx(fs,{currentPage:y,totalPages:Math.ceil(j.length/I),onPageChange:P})]})};function re(t){m.useEffect(()=>{const s=document.title;return document.title=t?`${t} - BadgeHub`:"BadgeHub",()=>{document.title=s}},[t])}const bs=(t=H)=>m.useCallback(async s=>{var r;const a=await(t==null?void 0:t.getProjectSummaries({query:{category:s.category,badge:s.badge}}));switch(a.status){case 200:return a.body;default:throw new Error("Failed to fetch projects, reason "+((r=a.body)==null?void 0:r.reason))}},[t]),js=m.memo(({tsRestClient:t=H})=>{re("");const s=bs(t),[a,r]=m.useState("");return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-900 text-slate-200","data-testid":"main-page",children:[e.jsx(ee,{searchQuery:a,setSearchQuery:r}),e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow",children:[e.jsx(Ct,{}),e.jsx(st,{appFetcher:s,searchQuery:a})]}),e.jsx(te,{})]})}),vs=({project:t})=>{var a,r,n,o,i,l;const s=t.version.app_metadata;return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-100 mb-2","data-testid":"app-detail-name",children:s.name}),((a=t.version)==null?void 0:a.app_metadata.author)&&e.jsxs("p",{className:"text-slate-400 mb-1",children:["By ",(r=t.version)==null?void 0:r.app_metadata.author]})||null,e.jsxs("p",{className:"text-xs text-slate-500",children:["Published:"," ",(n=t.version)!=null&&n.published_at?new Date((o=t.version)==null?void 0:o.published_at).toLocaleDateString():"—"]})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-4 flex-shrink-0 flex items-center",children:e.jsx(Se,{url:s.git_url,showText:!0})})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(i=s.badges)==null?void 0:i.map(h=>e.jsx("span",{className:"tag-mcu text-sm font-semibold mr-2 px-3 py-1 rounded-full",children:h},h)),(l=s.categories)==null?void 0:l.map(h=>e.jsx("span",{className:"tag text-sm font-semibold mr-2 px-3 py-1 rounded-full",children:h},h)),[].map(h=>e.jsx("span",{className:"tag text-sm font-semibold mr-2 px-3 py-1 rounded-full",children:h},h))]})]})},ys=({project:{version:{app_metadata:t}}})=>e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Description"}),e.jsx("div",{className:"prose prose-sm sm:prose lg:prose-lg xl:prose-xl max-w-none text-slate-300 space-y-4",children:t.description?e.jsx("pre",{children:t.description}):e.jsx("p",{children:"No description provided."})})]});class ws extends Error{}const M=(t,s)=>{if(t===void 0){const a="";throw new ws(`Unexpected value: undefined${a}`)}},Ns=t=>t.split("/").pop()||t,Cs=["js","jsx","ts","tsx","html","css","scss","sass","less","xml","yaml","yml","md","sh","bash","c","cpp","java","php","rb","go","rs","sql","txt"],at=["png","jpg","jpeg","gif","svg","webp","bmp","tiff","tif","avif"],Es=[".png",".jpg",".jpeg",".gif",".svg",".md",".txt",".json"],_s=t=>{const s=t.toLowerCase();return!Es.some(a=>s.endsWith(a))},ue=(t,s)=>{if(t.startsWith("image/"))return"image";if(t==="application/json")return"json";if(t==="text/x-python"||t==="application/x-python-code"||t==="text/x-python-script")return"python";if(t==="text/plain"||t.startsWith("text/"))return"text";if(s&&(t==="application/octet-stream"||t==="application/octet")){const a=s.toLowerCase().split(".").pop()||"";if(a==="py")return"python";if(a==="json")return"json";if(Cs.includes(a))return"text";if(at.includes(a))return"image"}return"unsupported"},Ss=t=>{const s=t.toLowerCase().split(".").pop()||"";return{js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",py:"python",json:"json",html:"html",css:"css",scss:"scss",sass:"sass",less:"less",xml:"xml",yaml:"yaml",yml:"yaml",md:"markdown",sh:"bash",bash:"bash",c:"c",cpp:"cpp",java:"java",php:"php",rb:"ruby",go:"go",rs:"rust",sql:"sql"}[s]||"text"};async function nt(t,s,a){try{M(t);const n=await(await k(t)).getDraftFile({params:{slug:s,filePath:a.full_path}});if(n.status===200&&n.body){const o=window.URL.createObjectURL(n.body),i=document.createElement("a");i.href=o,i.download=Ns(a.full_path),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o)}}catch(r){console.error("Failed to download file:",r)}}const As=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4 text-slate-300 hover:text-slate-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,style:{display:"inline",verticalAlign:"middle"},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"})}),Ls=({content:t})=>{const[s,a]=m.useState(!1),n=s?(o=>{try{const i=JSON.parse(o);return JSON.stringify(i,null,2)}catch(i){return console.warn("Failed to parse JSON, displaying raw content:",i),o}})(t):t;return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-slate-300 text-sm",children:"JSON file"}),e.jsx("button",{type:"button",onClick:()=>a(!s),className:"px-2 py-1 bg-slate-700 text-slate-200 rounded text-xs hover:bg-slate-600",children:s?"Show Raw":"Pretty Print"})]}),e.jsx("div",{className:"rounded overflow-hidden",children:e.jsx(ye,{language:"json",style:we.atomOneDark,customStyle:{background:"#1e293b",padding:"1rem",margin:0,fontSize:"0.875rem",lineHeight:"1.25rem"},showLineNumbers:!1,wrapLines:!0,wrapLongLines:!0,children:n})})]})},Ts=({content:t})=>e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-slate-300 text-sm",children:"Python file"})}),e.jsx("div",{className:"rounded overflow-hidden",children:e.jsx(ye,{language:"python",style:we.atomOneDark,customStyle:{background:"#1e293b",padding:"1rem",margin:0,fontSize:"0.875rem",lineHeight:"1.25rem"},showLineNumbers:!1,wrapLines:!0,wrapLongLines:!0,children:t})})]}),Ps=({content:t,filename:s})=>{const a=Ss(s);return a==="text"?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"text-slate-300 text-sm",children:"Text file"})}),e.jsx("pre",{className:"text-slate-300 whitespace-pre-wrap break-words",children:e.jsx("code",{children:t})})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-slate-300 text-sm",children:[a," file"]})}),e.jsx("div",{className:"rounded overflow-hidden",children:e.jsx(ye,{language:a,style:we.atomOneDark,customStyle:{background:"#1e293b",padding:"1rem",margin:0,fontSize:"0.875rem",lineHeight:"1.25rem"},showLineNumbers:!1,wrapLines:!0,wrapLongLines:!0,children:t})})]})},Is=({file:t,imageBlob:s})=>{const[a,r]=m.useState(t.url||"");return m.useEffect(()=>{if(s){const n=URL.createObjectURL(s);return r(n),()=>URL.revokeObjectURL(n)}else t.url&&r(t.url)},[s,t.url]),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"text-slate-300 text-sm",children:["Image file"," ",t.image_width&&t.image_height&&`(${t.image_width}×${t.image_height})`]})}),e.jsx("div",{className:"flex justify-center",children:a&&e.jsx("img",{src:a,alt:t.full_path,className:"max-w-full max-h-96 rounded border border-slate-600",style:{maxHeight:"400px"}})})]})},Rs=({mimetype:t})=>e.jsxs("div",{className:"text-center py-8 text-slate-400",children:[e.jsx("p",{children:"Preview not available for this file type."}),e.jsxs("p",{className:"text-sm mt-2",children:["MIME type: ",t]}),e.jsx("p",{className:"text-sm",children:"Use the download button to view the file."})]}),ks=(t,s,a,r,n)=>{if(t)return e.jsx("div",{className:"text-slate-400",children:"Loading file..."});if(!s)return e.jsx("div",{className:"text-slate-400",children:"No file selected"});if(!a)return e.jsx("div",{className:"text-slate-400",children:"File not found"});switch(ue(a.mimetype,a.full_path)){case"image":return e.jsx(Is,{file:a,imageBlob:n});case"json":return r?e.jsx(Ls,{content:r}):e.jsx("div",{className:"text-slate-400",children:"Loading JSON..."});case"python":return r?e.jsx(Ts,{content:r}):e.jsx("div",{className:"text-slate-400",children:"Loading Python file..."});case"text":return r?e.jsx(Ps,{content:r,filename:a.full_path}):e.jsx("div",{className:"text-slate-400",children:"Loading text file..."});case"unsupported":return e.jsx(Rs,{mimetype:a.mimetype});default:return e.jsx("div",{className:"text-slate-400",children:"Unknown file type"})}},rt=({project:t,isDraft:s=!1,keycloak:a,previewedFile:r,showFileList:n=!0})=>{var I;const o=m.useMemo(()=>{var j;return((j=t==null?void 0:t.version)==null?void 0:j.files)??[]},[(I=t==null?void 0:t.version)==null?void 0:I.files]),[i,l]=m.useState(null),[h,p]=m.useState(null),[b,u]=m.useState(null),[x,c]=m.useState(!1),g=o.find(j=>j.full_path===i)||null;m.useEffect(()=>{if(r!==void 0){l(r);return}if(!(o!=null&&o.length)){l(null),p(null),u(null);return}const j=o.find(N=>N.name==="__init__"&&N.ext==="py"||N.full_path==="__init__.py");j?l(j.full_path):(l(null),p(null),u(null))},[o,r]),m.useEffect(()=>{if(!i||!g){p(null),u(null);return}if(ue(g.mimetype,g.full_path)==="unsupported"){p(null),u(null),c(!1);return}c(!0),(async()=>{try{if(s){M(a);const A=await(await k(a)).getDraftFile({params:{slug:t.slug,filePath:i}});if(A.status===200&&A.body){const O=A.body;if(ue(g.mimetype,g.full_path)==="image")u(O),p(null);else{const S=await O.text();p(S),u(null)}}else p("// Unable to load file"),u(null)}else{const N=await H.getLatestPublishedFile({params:{slug:t.slug,filePath:i}});if(N.status===200)if(ue(g.mimetype,g.full_path)==="image")u(null),p(null);else if(typeof N.body=="string")p(N.body),u(null);else if(N.body instanceof Blob){const A=await N.body.text();p(A),u(null)}else p("// Unable to display file content"),u(null);else p("// Unable to load file"),u(null)}}catch(N){console.error("Failed to fetch file content:",N),p("// Network error - please check your connection and try again"),u(null)}finally{c(!1)}})()},[i,t.slug,g,s,a]);const y=j=>{l(j)},P=async j=>{s?await nt(a,t.slug,j):window.location.href=j.url};return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg text-left","data-testid":"code-preview-section",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Code Preview / Files"}),n&&e.jsx("div",{className:"flex flex-col md:flex-row gap-8",children:e.jsxs("div",{className:"md:w-1/3 w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-slate-200 mb-2",children:"Project Files:"}),e.jsx("ul",{className:"list-none text-slate-400 text-sm space-y-1",children:o.map((j,N)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"px-1 py-1 bg-slate-700 rounded hover:bg-slate-600",onClick:()=>P(j),title:"Download file",style:{display:"flex",alignItems:"center",justifyContent:"center",background:"none",border:"none",cursor:"pointer"},children:e.jsx(As,{})}),e.jsx("button",{type:"button",className:`text-left hover:underline font-mono ${i===j.full_path?"text-slate-100 font-bold":"text-slate-400"}`,onClick:()=>y(j.full_path),onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),y(j.full_path))},style:{background:"none",border:"none",padding:0,cursor:"pointer"},title:"Preview file","aria-label":`Preview ${j.full_path}`,children:j.full_path}),j.size_formatted?e.jsx("span",{className:"ml-2 text-slate-500",children:j.size_formatted}):null]},N))})]})}),e.jsx("div",{className:n?"mt-6 md:ml-0":"mt-4",children:e.jsx("div",{className:"code-block font-mono text-sm bg-gray-900 rounded p-4 overflow-x-auto min-h-[200px]",children:ks(x,i,g,h,b||void 0)})})]})},Os=({project:t})=>{var o,i;const{app_metadata:s,revision:a}=t.version,r=s.version&&s.version.trim().length>0?s.version:null,n=s.license_type&&s.license_type.trim().length>0?s.license_type:null;return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100 mb-4 border-b border-gray-700 pb-2",children:"App Details"}),e.jsxs("ul",{className:"text-sm text-slate-300 space-y-3 font-mono",children:[r&&e.jsxs("li",{children:[e.jsx("strong",{children:"Version:"})," ",r]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Revision:"})," ",a??"—"]}),n&&e.jsxs("li",{children:[e.jsx("strong",{children:"License:"})," ",n]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Badges:"})," ",((o=s.badges)==null?void 0:o.join(", "))??"—"," "]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Categories:"})," ",((i=s.categories)==null?void 0:i.join(","))??"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Type:"})," ",s.project_type??"app"]}),e.jsxs("li",{className:"todoElement",children:[e.jsx("strong",{children:"Downloads:"})," ","Download count not available"]}),e.jsxs("li",{className:"todoElement",children:[e.jsx("strong",{children:"Rating:"})," ","4.8/5 (120 votes)"]})]})]})},Ds=({project:t})=>{const s=t.author||{};return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg todoElement",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100 mb-4 border-b border-gray-700 pb-2",children:"Author"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:s.avatarUrl||"https://placehold.co/50x50/047857/D1FAE5?text=DG",alt:"Author Avatar",className:"w-12 h-12 rounded-full mr-4"}),e.jsxs("div",{children:[e.jsx("a",{href:"#",className:"text-lg font-semibold text-emerald-400 hover:underline",children:s.displayName||s.username||"Unknown"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Joined:"," ",s.createdAt?new Date(s.createdAt).toLocaleDateString():"Jan 2022"]})]})]}),e.jsx("p",{className:"text-sm text-slate-400 mt-3",children:s.bio||"Passionate about embedded systems and open-source. Sharing my projects with the community!"}),e.jsx("a",{href:"#",className:"mt-3 inline-block btn-secondary px-4 py-2 rounded-md text-xs font-semibold w-full text-center todoElement",children:"View Profile"})]})},Ae=(t,s,a={})=>{const{enabled:r=!0}=a,[n,o]=m.useState(null),[i,l]=m.useState(null),[h,p]=m.useState(r),[b,u]=m.useState(0),x=m.useCallback(()=>{u(c=>c+1)},[]);return m.useEffect(()=>{if(!r){p(!1);return}let c=!0;return p(!0),l(null),t().then(g=>{c&&o(g)}).catch(g=>{c&&l(g instanceof Error?g:new Error("Unknown error occurred"))}).finally(()=>{c&&p(!1)}),()=>{c=!1}},[r,b,...s]),{data:n,error:i,loading:h,reload:x}},ot=t=>t===404?"not_found":"unknown",it=t=>t instanceof Error&&(t.message==="not_found"||t.message==="unknown")?t.message:"unknown",lt=t=>{switch(t){case"not_found":return"App not found.";default:return"Failed to load project."}},Fs=({project:t})=>{var s;return e.jsxs("div",{className:"flex items-start space-x-3",children:[((s=t.icon_map)==null?void 0:s["64x64"])&&e.jsx("img",{src:t.icon_map["64x64"].url,alt:`${t.name} Icon`,className:"h-12 w-12 flex-shrink-0 rounded-md bg-gray-700 object-cover",onError:a=>{a.currentTarget.src=ze}}),e.jsxs("div",{children:[e.jsx("a",{href:`/page/project/${t.slug}`,className:"text-sm font-semibold text-emerald-400 hover:underline",children:t.name}),t.categories&&t.categories.length>0&&e.jsx("p",{className:"text-xs text-slate-400",children:t.categories.join(", ")})]})]})},Bs=()=>e.jsx(e.Fragment,{children:[...Array(3)].map((t,s)=>e.jsxs("div",{className:"flex animate-pulse items-start space-x-3",children:[e.jsx("div",{className:"h-12 w-12 flex-shrink-0 rounded-md bg-gray-700"}),e.jsxs("div",{className:"flex-grow space-y-2 pt-1",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-gray-700"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-gray-700"})]})]},s))}),Ms=({project:t,tsRestClient:s=H})=>{const{data:a,error:r,loading:n}=Ae(async()=>{if(!t.idp_user_id)return[];const i=await s.getProjectSummaries({query:{userId:t.idp_user_id,pageLength:4}});if(i.status===200)return i.body.filter(l=>l.slug!==t.slug).slice(0,3);throw new Error(ot(i.status))},[t.idp_user_id,t.slug,s]),o=()=>n?e.jsx(Bs,{}):r?e.jsx("p",{className:"text-sm text-red-400",children:lt(it(r))}):a&&a.length>0?a.map(i=>e.jsx(Fs,{project:i},i.slug)):e.jsx("p",{className:"text-sm text-slate-400",children:"No other projects by this author found."});return e.jsxs("section",{className:"w-full max-w-sm rounded-lg bg-gray-800 p-6 shadow-lg",children:[e.jsxs("h2",{className:"mb-4 border-b border-gray-700 pb-2 text-xl font-semibold text-slate-100",children:["Other Projects by ",t.version.app_metadata.author||"this author"]}),e.jsx("div",{className:"space-y-4",children:o()})]})},Us=({projectName:t})=>e.jsx("nav",{className:"mb-6 text-sm","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"list-none p-0 inline-flex space-x-2",children:[e.jsx("li",{className:"flex items-center",children:e.jsx(G,{to:"/",className:"text-emerald-400 hover:text-emerald-300",children:"Home"})}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx(G,{to:"/#apps-grid",className:"text-emerald-400 hover:text-emerald-300",children:"Apps"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx("span",{className:"text-slate-500",children:t})]})]})}),Gs=({tsRestClient:t=H,slug:s})=>{re(s);const{data:a,error:r,loading:n}=Ae(async()=>{const l=await t.getProject({params:{slug:s}});if(l.status===200)return l.body;throw new Error(ot(l.status))},[s,t]),o=r?lt(it(r)):null;if(n)return e.jsx("div",{className:"flex justify-center items-center h-64 text-slate-400 bg-gray-900 min-h-screen",children:"Loading..."});if(o)return e.jsx("div",{"data-testid":"app-detail-error",className:"flex justify-center items-center h-64 text-red-400 bg-gray-900 min-h-screen",children:o});if(!a)return e.jsx("div",{"data-testid":"app-detail-error",className:"flex justify-center items-center h-64 text-red-400 bg-gray-900 min-h-screen",children:"App not found."});const i=a.version.app_metadata;return e.jsxs("div",{"data-testid":"app-detail-page",className:"min-h-screen flex flex-col bg-gray-900 text-slate-200",children:[e.jsx(ee,{}),e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow",children:[e.jsx(Us,{projectName:i.name??a.slug}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[e.jsx(vs,{project:a}),e.jsx(ys,{project:a}),e.jsx(rt,{project:a})]}),e.jsxs("aside",{className:"lg:col-span-1 space-y-8",children:[e.jsx(Os,{project:a}),e.jsx(Ds,{project:a}),e.jsx(Ms,{project:a,tsRestClient:t})]})]})]}),e.jsx(te,{})]})},$s=({project:t})=>{const s=t.version.app_metadata;return e.jsx("nav",{className:"mb-6 text-sm","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"list-none p-0 inline-flex space-x-2",children:[e.jsx("li",{className:"flex items-center",children:e.jsx(G,{to:"/",className:"text-emerald-400 hover:text-emerald-300",children:"Home"})}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx(G,{to:"/page/my-projects",className:"text-emerald-400 hover:text-emerald-300",children:"Apps"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx(G,{to:`/page/project/${t.slug}`,className:"text-emerald-400 hover:text-emerald-300",children:s.name})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"Edit"})]})]})})},Hs=({form:t,onChange:s})=>e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"appName",className:"block text-sm font-medium text-slate-300 mb-1",children:"App Name"}),e.jsx("input",{type:"text",id:"appName",className:"w-full form-input p-2 bg-gray-700 border-gray-600 rounded-md text-slate-200 focus:ring-emerald-500 focus:border-emerald-500",value:t.name||"",onChange:a=>s({name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"author",className:"block text-sm font-medium text-slate-300 mb-1",children:"Author"}),e.jsx("input",{type:"text",id:"author",className:"w-full form-input p-2 bg-gray-700 border-gray-600 rounded-md text-slate-200 focus:ring-emerald-500 focus:border-emerald-500",value:t.author||"",onChange:a=>s({author:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"gitUrl",className:"block text-sm font-medium text-slate-300 mb-1 flex items-center",children:["Git URL",e.jsx(Se,{url:t.git_url})]}),e.jsx("input",{type:"url",id:"gitUrl",placeholder:"https://github.com/user/repo",className:"w-full form-input p-2 bg-gray-700 border-gray-600 rounded-md text-slate-200 focus:ring-emerald-500 focus:border-emerald-500",value:t.git_url||"",onChange:a=>s({git_url:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"version",className:"block text-sm font-medium text-slate-300 mb-1",children:"Version"}),e.jsx("input",{type:"text",id:"version",placeholder:"1.0.0",className:"w-full form-input p-2 bg-gray-700 border-gray-600 rounded-md text-slate-200 focus:ring-emerald-500 focus:border-emerald-500",value:t.version||"",onChange:a=>s({version:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{id:"description",rows:4,className:"w-full form-input p-2 bg-gray-700 border-gray-600 rounded-md text-slate-200 focus:ring-emerald-500 focus:border-emerald-500",value:t.description||"",onChange:a=>s({description:a.target.value})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("label",{htmlFor:"hidden",className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",id:"hidden",className:"h-4 w-4 rounded border-gray-600 bg-gray-700 text-emerald-600 focus:ring-emerald-500",checked:!!t.hidden,onChange:a=>s({hidden:a.target.checked})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-slate-300",children:"Hidden"})]}),e.jsx("p",{className:"ml-4 text-xs text-slate-500",children:"If checked, this app will not appear in public listings."})]})]})]}),ct=({title:t,noValueSetName:s,valueMap:a,value:r,onValueSelection:n})=>{const o=`${t.toLowerCase()}-dropdown`,i=`${t.toLowerCase()}-search`,l=r??[],[h,p]=m.useState(""),b=m.useMemo(()=>{const c=h.trim().toLowerCase(),g=Object.entries(a);return c?g.filter(([y,P])=>y.toLowerCase().includes(c)||P.toLowerCase().includes(c)):g},[h,a]),u=c=>{if(l.includes(c)){n(l.filter(g=>g!==c));return}n([...l,c])},x=l.map(c=>[c,a[c]]).filter(([,c])=>c!==void 0);return e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-slate-300 mb-1",children:t}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{htmlFor:i,className:"block text-xs font-medium text-slate-400 mb-1",children:["Search ",t]}),e.jsx("input",{id:i,"data-testid":i,type:"text",value:h,onChange:c=>p(c.target.value),className:"w-full border-gray-600 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500 p-2 text-sm",placeholder:"Type to filter"})]}),x.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 mb-2",children:"Selected"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map(([c,g])=>e.jsxs("button",{type:"button",onClick:()=>u(c),className:"inline-flex items-center gap-2 rounded-full bg-emerald-700/30 text-emerald-200 px-3 py-1 text-xs hover:bg-emerald-700/50",title:`Remove ${g}`,children:[e.jsx("span",{children:g}),e.jsx("span",{"aria-hidden":!0,children:"×"})]},c))})]}),e.jsxs("div",{id:o,"data-testid":o,className:"max-h-40 overflow-y-auto rounded-md border border-gray-700 p-2 space-y-2",children:[b.map(([c,g])=>e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-600 bg-gray-700 text-emerald-600 focus:ring-emerald-500",checked:l.includes(c),onChange:()=>u(c)}),e.jsx("span",{className:"text-slate-300",children:g})]},c)),b.length===0&&e.jsx("p",{className:"text-xs text-slate-500",children:s})]}),l.length===0&&b.length>0&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s})]})},zs=({categories:t,onCategoryChange:s,noValueSetName:a})=>{const r=Object.fromEntries(Ce().map(h=>[h,h])),n=t??[],[o,i]=m.useState(null),l=h=>{if(h.filter(b=>!Ot(b)).length>3){i("You can set at most 3 categories");return}i(null),s(h)};return e.jsxs("div",{children:[e.jsx(ct,{noValueSetName:a,title:"Category",valueMap:r,value:n,onValueSelection:l}),o&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:o})]})},Vs=({badges:t,onBadgeChange:s,noValueSetName:a})=>{const r=Object.fromEntries(Ve.map(n=>[n,n]));return e.jsx(ct,{noValueSetName:a,title:"Badge",valueMap:r,value:t,onValueSelection:s})},Ks=({form:t,onChange:s})=>e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Categorization"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Vs,{noValueSetName:"Please select",badges:t.badges,onBadgeChange:a=>s({badges:a.length===0?void 0:a})}),e.jsx(zs,{noValueSetName:"Please select",categories:t.categories,onCategoryChange:a=>s({categories:a.length===0?void 0:a})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"licenseType",className:"block text-sm font-medium text-slate-300 mb-1",children:"License Type"}),e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"License Type, eg. MIT"}),e.jsx("input",{type:"text",className:"w-full form-input p-2",id:"licenseType",value:t.license_type||"",onChange:a=>s({license_type:a.target.value})})]})]})]}),Ys=({onClickDeleteApplication:t})=>e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Actions"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{type:"submit",className:"btn-primary px-6 py-3 rounded-lg font-semibold transition-all duration-200 ease-in-out transform hover:scale-105",children:"Save & Publish"}),e.jsx(G,{to:"..",className:"btn-secondary px-6 py-3 rounded-lg font-semibold transition-all duration-200 ease-in-out",children:"Cancel"})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",className:"btn-danger bg-red-700 px-6 py-3 rounded-lg font-semibold transition-all duration-200 ease-in-out flex items-center",onClick:t,children:[e.jsx("svg",{className:"icon h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Delete Application"]})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-4 text-right",children:"Deleting an application is permanent and cannot be undone."})]}),qs=({slug:t,onUploadSuccess:s,keycloak:a})=>{const[r,n]=m.useState(!1),[o,i]=m.useState(null),[l,h]=m.useState(null),p=async b=>{M(a),i(null),h(null);const u=b.target.files;if(!u||u.length===0)return;n(!0);let x=!1;try{for(const g of Array.from(u)){const y=new FormData;if(y.append("file",g),(await(await k(a)).writeDraftFile({params:{slug:t,filePath:g.name},body:y})).status!==204)throw new Error(`Upload failed for ${g.name}`);g.name==="metadata.json"&&(x=!0)}h("File(s) uploaded successfully.");const c=Array.from(u).find(g=>_s(g.name));s({metadataChanged:x,firstValidExecutable:c?c.name:null})}catch(c){console.error(c),i(c instanceof Error?c.message:"Failed to upload file(s).")}finally{n(!1),b.target.value=""}};return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Files"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Upload Files"}),e.jsx("input",{type:"file",name:"file-upload","data-testid":"app-edit-file-upload-input",className:"form-input w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100",multiple:!0,disabled:r,onChange:p}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:'You can upload any file type (e.g., code, images, docs). Executable file types will be selectable as "Main".'}),r&&e.jsx("p",{className:"text-xs text-emerald-400 mt-2",children:"Uploading..."}),o&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:o}),l&&e.jsx("p",{className:"text-xs text-emerald-400 mt-2",children:l})]})]})},dt=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"})}),Ws=t=>t.full_path!=="metadata.json",Xs=({file:t,iconFilePath:s,onSetIcon:a,onDeleteFile:r,mainExecutable:n,onSetMainExecutable:o,onPreview:i,slug:l,keycloak:h})=>{const p=s===t.full_path,b=a&&t.mimetype.startsWith("image/"),u=Ws(t),x=[...at.map(P=>`.${P}`),".md",".txt",".json"],c=u&&o&&!x.some(P=>t.full_path.toLowerCase().endsWith(P)),g=n===t.full_path,y=t.image_width&&t.image_height&&`${t.image_width}x${t.image_height}`||!1;return e.jsxs("li",{className:"flex items-center gap-2 p-1 rounded-md transition-colors duration-200 hover:bg-gray-700/50",children:[e.jsx("button",{type:"button",className:"bg-blue-600 text-white rounded p-1 flex items-center justify-center transition-colors hover:bg-blue-700",title:"Download draft file",onClick:()=>nt(h,l,t),children:e.jsx(tt,{})}),r&&e.jsx("button",{type:"button",className:`bg-red-600 text-white rounded p-1 flex items-center justify-center transition-colors ${u?"hover:bg-red-700":"opacity-50 cursor-not-allowed"}`,title:u?"Delete file":"This file cannot be deleted",onClick:()=>u&&r(t.full_path),disabled:!u,children:e.jsx(dt,{})}),i?e.jsx("button",{type:"button",className:"flex-grow font-mono text-slate-400 hover:text-slate-100 hover:underline text-left bg-transparent border-none cursor-pointer p-0",onClick:()=>i(t.full_path),title:"Preview file",children:t.full_path}):e.jsx("p",{className:"flex-grow font-mono text-slate-400",children:t.full_path}),t.size_formatted&&e.jsx("span",{className:"ml-2 text-slate-500 text-xs",children:t.size_formatted})," ",y&&e.jsxs("span",{className:"ml-2 text-slate-500 text-xs",children:[y,"px"]}),c&&e.jsx("button",{type:"button",disabled:g,onClick:()=>o(t.full_path),className:`ml-2 px-2 py-1 rounded text-xs ${g?"bg-blue-600 text-white cursor-default":"bg-gray-700 text-slate-300 hover:bg-blue-700"}`,title:g?"This is the main executable":"Set as main executable",children:g?"Main":"Set as Main"}),b&&e.jsx("button",{type:"button",className:`ml-2 px-2 py-1 rounded text-xs transition-colors duration-200 ${p?"bg-emerald-600 text-white cursor-default":"bg-gray-700 text-slate-300 hover:bg-emerald-700 hover:text-white"}`,onClick:()=>a(t.full_path),title:p?"This file is the current icon":"Set as icon",disabled:p,children:p?"Icon":"Set as Icon"})]})},Js=({project:t,onSetIcon:s,iconFilePath:a,onDeleteFile:r,mainExecutable:n,onSetMainExecutable:o,onPreview:i,slug:l,keycloak:h})=>{var b;const p=((b=t==null?void 0:t.version)==null?void 0:b.files)??[];return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg text-left mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Files"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-slate-200 mb-2",children:"Project Files:"}),p.length>0?e.jsx("ul",{className:"list-none text-slate-400 text-sm space-y-1",children:p.map(u=>e.jsx(Xs,{file:u,onDeleteFile:r,onSetIcon:s,iconFilePath:a,mainExecutable:n,onSetMainExecutable:o,onPreview:i,slug:l,keycloak:h},u.full_path))}):e.jsx("p",{className:"text-slate-500 italic",children:"No files in this project version."})]})]})},Qs=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Pe=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),Zs=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a10.05 10.05 0 013.543-5.175m4.332-1.332A10.034 10.034 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.05 10.05 0 01-1.625 3.325m-4.332-1.332a3 3 0 11-4.243-4.243m4.243 4.243l-4.243-4.243"})}),ea=({slug:t,keycloak:s})=>{const[a,r]=m.useState(null),[n,o]=m.useState(null),[i,l]=m.useState(!0),[h,p]=m.useState(null),[b,u]=m.useState(!0),[x,c]=m.useState(!1),[g,y]=m.useState(!1),[P,I]=m.useState(!1),j=m.useCallback(async()=>{l(!0),p(null);try{const L=await(await k(s)).getProjectApiTokenMetadata({params:{slug:t}});L.status===200?r(L.body):L.status===404?r(null):(p("Failed to fetch token information."),console.error(L))}catch(C){p("An error occurred while fetching token information."),console.error(C)}finally{l(!1)}},[t,s]);m.useEffect(()=>{j()},[j]);const N=async()=>{M(s),c(!0),p(null),o(null);try{const L=await(await k(s)).createProjectAPIToken({params:{slug:t},body:void 0});L.status===200?(o(L.body.token),u(!0),await j()):(p("Failed to generate token."),console.error(L))}catch(C){p("An error occurred while generating the token."),console.error(C)}finally{c(!1)}},A=async()=>{if(window.confirm("Are you sure you want to revoke the API token? This action cannot be undone.")){M(s),c(!0),p(null);try{const L=await(await k(s)).revokeProjectAPIToken({params:{slug:t}});L.status===204?(r(null),o(null)):(p("Failed to revoke token."),console.error(L))}catch(C){p("An error occurred while revoking the token."),console.error(C)}finally{c(!1)}}},O=()=>{n&&(navigator.clipboard.writeText(n),y(!0),setTimeout(()=>y(!1),2e3))},S=Ze.getDraftProject,w=`curl -H "badgehub-api-token: ${n&&b?n:"YOUR_PROJECT_TOKEN"}" ${Ne}${S.path.replace(":slug",t)}`,v=()=>{navigator.clipboard.writeText(w),I(!0),setTimeout(()=>I(!1),2e3)};return i?e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"API Token"}),e.jsx("p",{className:"text-slate-400",children:"Loading token information..."})]}):e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"API Token"}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsx("p",{className:"text-red-400",children:h}),n&&e.jsxs("div",{className:"bg-gray-900 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-emerald-400",children:"New Token Generated"}),e.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"Please copy this token. You will not be able to see it again."}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 p-2 rounded-md",children:[e.jsx("input",{type:b?"text":"password",readOnly:!0,value:n,className:"flex-grow bg-transparent border-none text-slate-200 font-mono focus:ring-0"}),e.jsx("button",{type:"button",onClick:()=>u(!b),className:"text-slate-400 hover:text-white",title:b?"Hide token":"Show token",children:b?e.jsx(Zs,{}):e.jsx(Qs,{})}),e.jsxs("button",{type:"button",onClick:O,className:"text-slate-400 hover:text-white relative",title:"Copy to clipboard",children:[e.jsx(Pe,{}),g&&e.jsx("span",{className:"absolute -top-7 right-0 bg-emerald-600 text-white text-xs rounded px-2 py-1",children:"Copied!"})]})]})]}),a?e.jsxs("div",{className:n?"mt-4":"",children:[!n&&e.jsx("p",{className:"text-slate-300",children:"An API token exists for this project."}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:gap-6",children:[e.jsxs("p",{className:"text-sm text-slate-500",children:[e.jsx("span",{className:"font-semibold",children:"Created:"})," ",new Date(a.created_at).toLocaleString()]}),a.last_used_at&&e.jsxs("p",{className:"text-sm text-slate-500",children:[e.jsx("span",{className:"font-semibold",children:"Last used:"})," ",new Date(a.last_used_at).toLocaleString()]})]}),e.jsxs("div",{className:"mt-6 mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-2",children:"Example Usage (cURL)"}),e.jsxs("div",{className:"flex items-start space-x-2 bg-gray-900 p-2 rounded-md font-mono text-sm",children:[e.jsx("pre",{className:"text-emerald-300 overflow-x-auto whitespace-pre-wrap flex-grow pt-1",children:e.jsx("code",{children:w})}),e.jsxs("button",{type:"button",onClick:v,className:"text-slate-400 hover:text-white relative",title:"Copy command",children:[e.jsx(Pe,{}),P&&e.jsx("span",{className:"absolute -top-7 right-0 bg-emerald-600 text-white text-xs rounded px-2 py-1",children:"Copied!"})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("button",{type:"button",onClick:A,disabled:x,className:"bg-red-600 text-white rounded px-4 py-2 flex items-center gap-2 hover:bg-red-700 disabled:opacity-50",children:[e.jsx(dt,{}),"Revoke Token"]}),e.jsx("button",{type:"button",onClick:N,disabled:x,className:"bg-blue-600 text-white rounded px-4 py-2 hover:bg-blue-700 disabled:opacity-50",children:"Regenerate Token"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300",children:"No active API token."}),e.jsx("button",{type:"button",onClick:N,disabled:x,className:"mt-4 bg-emerald-600 text-white rounded px-4 py-2 hover:bg-emerald-700 disabled:opacity-50",children:"Generate New Token"})]})]})]})},ta=({project:t,appMetadata:s,slug:a,user:r,keycloak:n,previewedFile:o,mainExecutable:i,onPreviewFile:l,onSetIcon:h,onDeleteFile:p,onSetMainExecutable:b,onUploadSuccess:u,onFormChange:x,onSubmit:c,onDeleteApplication:g})=>{var y;return e.jsxs(e.Fragment,{children:[e.jsx($s,{project:t}),e.jsxs("h1",{className:"text-3xl font-bold text-slate-100 mb-6",children:["Editing ",t.slug,"/rev",t.version.revision]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("form",{className:"space-y-8",onSubmit:c,children:[e.jsx(Ys,{onClickDeleteApplication:g}),e.jsx(Hs,{form:s,onChange:x}),e.jsx(Ks,{form:s,onChange:x}),e.jsx(qs,{slug:a,keycloak:n,onUploadSuccess:u}),e.jsx(Js,{user:r,project:t,onSetIcon:h,iconFilePath:(y=s==null?void 0:s.icon_map)==null?void 0:y["64x64"],onDeleteFile:p,mainExecutable:i,onSetMainExecutable:b,onPreview:l,slug:a,keycloak:n}),e.jsx(rt,{project:t,isDraft:!0,keycloak:n,previewedFile:o,showFileList:!1})]}),e.jsx(ea,{slug:a,keycloak:n})]})]})},sa=({loading:t,error:s,onLogin:a,children:r})=>!t&&s?e.jsx("div",{"data-testid":"app-edit-error",className:"flex flex-col justify-center items-center h-64 text-center bg-gray-900",children:s==="authentication"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-yellow-400 text-xl mb-4",children:"Authentication Required"}),e.jsx("div",{className:"text-slate-400 mb-4",children:"You need to log in to edit this project."}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 transition-colors",children:"Log In"})]}):s==="not_found"?e.jsx("div",{className:"text-red-400",children:"App not found."}):e.jsx("div",{className:"text-red-400",children:"Failed to load project. Please try again."})}):t?e.jsx("div",{className:"flex justify-center items-center h-64 text-slate-400 bg-gray-900",children:"Loading..."}):e.jsx(e.Fragment,{children:r}),aa=t=>t===401||t===403?"authentication":t===404?"not_found":"unknown",Ie=t=>t instanceof Error&&(t.message==="authentication"||t.message==="not_found"||t.message==="unknown")?t.message:"unknown",na=(t,s)=>{const[a,r]=m.useState(null),n=!!s&&(!a||a.stale),{data:o,error:i,loading:l}=Ae(async()=>{if(!s)throw new Error("authentication");try{const p=await(await k(s)).getDraftProject({params:{slug:t}});if(p.status===200)return p.body;throw new Error(aa(p.status))}catch(p){throw console.error("Failed to fetch draft project:",p),s.authenticated?new Error(Ie(p)):new Error("authentication")}},[s,a==null?void 0:a.stale,t],{enabled:n});m.useEffect(()=>{o&&r(o)},[o]);const h=s?i?Ie(i):null:"authentication";return{project:a,setProject:r,loading:l,error:h}};function Re(t){var a;const s=((a=t.version.app_metadata.application)==null?void 0:a[0])||{};return t.version.app_metadata.application=t.version.app_metadata.application||[],t.version.app_metadata.application[0]=s,s}const ra=({slug:t})=>{var S,E;const[s,a]=m.useState(null),{user:r,keycloak:n}=Z(),o=Ge(),{project:i,setProject:l,loading:h,error:p}=na(t,n),b=w=>{l(v=>{if(!v)return null;const C=typeof w=="function"?w(v.version.app_metadata):w;return{...v,version:{...v.version,app_metadata:C}}})},u=i==null?void 0:i.version.app_metadata;u&&(u.author??(u.author=r==null?void 0:r.name));const x=w=>{b(v=>({...v,...w}))},c=async w=>{if(M(n),await n.updateToken(30),w.metadataChanged){l(null);return}const v=await(await k(n)).getDraftProject({params:{slug:t}});v.status===200&&i?l(C=>{var X,oe;if(!C)return null;const L={...C,version:{...C.version,files:v.body.version.files}};if(!((oe=(X=L.version.app_metadata.application)==null?void 0:X[0])==null?void 0:oe.executable)&&w.firstValidExecutable){const pt=Re(L);pt.executable=w.firstValidExecutable}return L}):window.alert("File refresh after upload failed")},g=async w=>{M(n),await(await k(n)).deleteDraftFile({params:{slug:t,filePath:w}}),l(v=>{var X;if(!v)return null;const C=v.version.files.filter(oe=>oe.full_path!==w),L={...v.version.app_metadata},U=(X=L.application)==null?void 0:X[0];return U&&(U==null?void 0:U.executable)===w&&(U.executable=void 0),{...v,version:{...v.version,files:C,app_metadata:L}}})},y=(E=(S=u==null?void 0:u.application)==null?void 0:S[0])==null?void 0:E.executable,P=w=>{l(v=>{if(!v)return v;const C=Re(v);return C.executable=w,{...v}})},I=async w=>{if(M(n),w.preventDefault(),!!u)try{const v=await(await k(n)).changeDraftAppMetadata({params:{slug:t},body:u});if(v.status!==204){console.error("changeDraftAppMetadata failed",v),window.alert("Save failed");return}if((await(await k(n)).publishVersion({params:{slug:t},body:void 0})).status!==204){console.error("publish failed",v),window.alert("Publish failed");return}i&&l({...i,stale:!0,version:{...i.version,app_metadata:u}})}catch(v){console.error(v),window.alert("Something went wrong during Save & Publish.")}},j=async()=>{try{M(n);const w=await(await k(n)).deleteProject({params:{slug:t}});if(w.status!==204){console.error("publish failed",w),window.alert("Publish failed");return}o("/page/my-projects")}catch(w){console.error(w),window.alert("Something went wrong during Save & Publish.")}},N=async w=>{M(n);try{await n.updateToken(30);const v=await k(n),C=await v.setDraftIconFromFile({params:{slug:t},body:{filePath:w,sizes:["64x64"]}});if(C.status!==200){console.error("setDraftIconFromFile failed",C),window.alert("Setting icon failed");return}const L=await v.getDraftProject({params:{slug:t}});if(L.status===200){l(L.body);return}b(U=>({...U,icon_map:{...U.icon_map,...C.body.iconPaths}}))}catch(v){console.error(v),window.alert("Something went wrong while setting the icon.")}},A=w=>P(w),O=w=>{a(w)};return e.jsxs("div",{"data-testid":"app-edit-page",className:"min-h-screen flex flex-col bg-gray-900 text-slate-200",children:[e.jsx(ee,{}),e.jsx("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow",children:e.jsx(sa,{loading:h,error:p??(!i||!u?"not_found":null),onLogin:()=>n==null?void 0:n.login(),children:i&&u&&n&&e.jsx(ta,{project:i,appMetadata:u,slug:t,user:r,keycloak:n,previewedFile:s,mainExecutable:y,onPreviewFile:O,onSetIcon:N,onDeleteFile:g,onSetMainExecutable:A,onUploadSuccess:c,onFormChange:x,onSubmit:I,onDeleteApplication:j})})}),e.jsx(te,{})]})},oa=()=>e.jsx("nav",{className:"mb-6 text-sm","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"list-none p-0 inline-flex space-x-2",children:[e.jsx("li",{className:"flex items-center",children:e.jsx(G,{to:"/",className:"text-emerald-400 hover:text-emerald-300",children:"Home"})}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2 text-slate-400",children:"/"}),e.jsx("span",{className:"text-slate-500",children:"Create New App"})]})]})}),ia=/^[a-z][.a-z_0-9-]{2,100}$/,la=/[^.a-z_0-9-]/,ca="^[a-z][.a-z_0-9-]{2,100}$",da=({form:t,onChange:s})=>{const a=t.slug||"";return e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"App Identifier (Slug)"}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"App Identifier (Slug)"}),e.jsx("input",{type:"text",className:"w-full form-input p-2 font-mono",placeholder:"e.g., my_weather_station or com.example.myapp",value:a,onChange:r=>{const n=r.target.value.replace(la,"_");s({slug:n})},"data-testid":"app-creation-slug-input",pattern:ca,autoComplete:"off"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Lowercase letters, numbers, and underscores only. Should start with a letter and contain at least 3 characters."})]})})]})},ma=({isSlugValid:t})=>e.jsxs("section",{className:"bg-gray-800 p-6 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-100 mb-4",children:"Submit"}),e.jsx("div",{className:"flex items-center justify-start",children:e.jsxs("button",{type:"submit",className:`btn-primary px-8 py-3 rounded-lg font-semibold transition-all duration-200 ease-in-out transform hover:scale-105 flex items-center space-x-2 ${t?"":"opacity-50 cursor-not-allowed hover:scale-100"}`,"data-testid":"app-creation-submit-btn",disabled:!t,children:[e.jsx("svg",{className:"icon h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.25a.75.75 0 00-1.5 0v2.5h-2.5a.75.75 0 000 1.5h2.5v2.5a.75.75 0 001.5 0v-2.5h2.5a.75.75 0 000-1.5h-2.5v-2.5z",clipRule:"evenodd"})}),e.jsx("span",{children:"Create Application"})]})}),e.jsx("p",{className:"text-xs text-slate-500 mt-4",children:"You can add code, media, and other details after creation."})]}),mt=({whatToSee:t})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"items-center justify-center bg-gray-900 text-slate-200 text-center",children:e.jsxs("p",{children:["Please log in to ",t,"."]})})}),ua={slug:""},pa=()=>{re("Create project");const[t,s]=m.useState(ua),[a,r]=m.useState(null),{user:n,keycloak:o}=Z(),i=Ge(),l=u=>{s(x=>({...x,...u}))},h=async u=>{M(o),u.preventDefault(),r(null);try{const x=await(await k(o)).createProject({params:{slug:t.slug}});if(x.status===204)i(`/page/project/${t.slug}/edit`);else{let c="Unknown error";x.body&&typeof x.body=="object"&&"reason"in x.body&&(c=x.body.reason),r(typeof c=="string"?c:"Unknown error")}}catch(x){r((x==null?void 0:x.message)||"Unknown error")}},p=ia.test(t.slug),b=(o==null?void 0:o.authenticated)&&(n==null?void 0:n.id);return e.jsxs("div",{"data-testid":"app-creation-page",className:"min-h-screen flex flex-col bg-gray-900 text-slate-200",children:[e.jsx(ee,{}),e.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow",children:[e.jsx(oa,{}),e.jsx("h1",{className:"text-3xl font-bold text-slate-100 mb-6",children:"Create a New Project"}),b?e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"mb-4 text-red-400 bg-red-900/40 border border-red-700 rounded px-4 py-2",children:a}),e.jsxs("form",{className:"space-y-8",onSubmit:h,children:[e.jsx(da,{form:t,onChange:l}),e.jsx(ma,{isSlugValid:p})]})]}):e.jsx(mt,{whatToSee:"create a project"})]}),e.jsx(te,{})]})},ha=({children:t})=>{const[s,a]=m.useState(void 0),[r,n]=m.useState(void 0),o=m.useRef(!1);return m.useEffect(()=>{if(o.current)return;o.current=!0;const i=new gt({url:It,realm:Rt,clientId:Tt});i.init({onLoad:"check-sso",pkceMethod:"S256",silentCheckSsoRedirectUri:`${Lt}/silent-check-sso.html`}).then(l=>{l&&i.tokenParsed?a({name:i.tokenParsed.name||i.tokenParsed.preferred_username||"User",email:i.tokenParsed.email||"",id:i.tokenParsed.sub||""}):a(void 0)}).catch(l=>{console.error("Keycloak initialization failed:",l),a(void 0)}).finally(()=>{n(i)})},[]),m.useEffect(()=>{if(!(!r||!r.authenticated))return r.onTokenExpired=async()=>{try{await r.updateToken(5)&&a(l=>l?{...l}:void 0)}catch(i){console.error("Session expired, redirecting to login",i),r.login()}},()=>{r.onTokenExpired=void 0}},[r]),e.jsx(He,{value:{user:s,keycloak:r},children:t})},xa=()=>e.jsxs("div",{style:{textAlign:"center",marginTop:"4rem",fontSize:"1.5rem"},children:["This page is under construction, come help construct it at"," ",e.jsx(K,{to:_t,external:!0,children:"our git repository"}),"!"]}),ga=({tsRestClient:t=H,user:s,keycloak:a})=>{const r=m.useCallback(async()=>{var i;if(!s||!a)throw new Error("Authentication required");await a.updateToken(30).catch(l=>{throw console.error("Failed to update token",l),new Error("Failed to update token. Please try logging in again.")});const o=await(t==null?void 0:t.getUserDraftProjects({params:{userId:s.id},headers:{authorization:`Bearer ${a.token}`}}).catch(l=>{throw console.error("Failed to fetch draft projects",l),new Error("Failed to fetch your draft projects. Message: "+l.message)}));switch(o.status){case 200:return o.body;default:throw new Error("Failed to fetch projects, reason "+((i=o.body)==null?void 0:i.reason))}},[a,t,s]);return(a==null?void 0:a.authenticated)&&(s==null?void 0:s.id)?r:void 0},fa=m.memo(({tsRestClient:t=H})=>{re("My Projects");const{user:s,keycloak:a}=Z(),[r,n]=m.useState(""),o=ga({tsRestClient:t,user:s,keycloak:a});return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-900 text-slate-200","data-testid":"my-projects-page",children:[e.jsx(ee,{searchQuery:r,setSearchQuery:n}),e.jsx("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow",children:o?e.jsx(st,{appFetcher:o,searchQuery:r,editable:!0}):e.jsx(mt,{whatToSee:"see your projects"})}),e.jsx(te,{})]})}),V="/api/v3";let ke=!1;const ba=new TextEncoder;function F(t,s){return new Response(JSON.stringify(s),{status:t,headers:{"content-type":"application/json"}})}function Oe(){return new Response(null,{status:204})}function ja(t){return t.pathname.replace(/\/+$/,"")||"/"}function va(t){t.run(`
    CREATE TABLE IF NOT EXISTS projects (
      slug TEXT PRIMARY KEY,
      name TEXT NOT NULL,
      description TEXT NOT NULL,
      category TEXT NOT NULL,
      badges TEXT NOT NULL,
      authorId TEXT NOT NULL,
      publishedRevision INTEGER NOT NULL DEFAULT 1,
      draftRevision INTEGER NOT NULL DEFAULT 2,
      metadataJson TEXT NOT NULL,
      updatedAt TEXT NOT NULL,
      createdAt TEXT NOT NULL
    );
  `),t.run(`
    CREATE TABLE IF NOT EXISTS project_files (
      slug TEXT NOT NULL,
      revision INTEGER NOT NULL,
      filePath TEXT NOT NULL,
      content TEXT NOT NULL,
      PRIMARY KEY (slug, revision, filePath)
    );
  `);const s=new Date().toISOString(),a={name:"Demo App",description:"Preview app backed by in-browser sqlite",category:"tools",badges:["fri3d-badge"],author:"preview-user",tags:["preview"]};t.run(`INSERT OR IGNORE INTO projects (slug, name, description, category, badges, authorId, metadataJson, updatedAt, createdAt)
     VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,["demo-app","Demo App","Preview app backed by in-browser sqlite","tools",JSON.stringify(["fri3d-badge"]),"preview-user",JSON.stringify(a),s,s]),t.run("INSERT OR IGNORE INTO project_files (slug, revision, filePath, content) VALUES (?, ?, ?, ?)",["demo-app",1,"main.py",`print('hello from github pages preview')
`])}function ce(t,s,a=[]){const r=t.prepare(s,a);try{return r.step()?r.getAsObject():null}finally{r.free()}}function ya(t,s,a=[]){const r=t.prepare(s,a),n=[];try{for(;r.step();)n.push(r.getAsObject())}finally{r.free()}return n}function ut(t){return{slug:t.slug,app_metadata_json:JSON.parse(String(t.metadataJson)),latest_published_revision:Number(t.publishedRevision),latest_draft_revision:Number(t.draftRevision),updated_at:String(t.updatedAt),created_at:String(t.createdAt),idp_user_id:String(t.authorId)}}function De(t){return{...ut(t),files:[]}}async function wa(){const t=await ft({locateFile:a=>`https://cdn.jsdelivr.net/npm/sql.js@1.12.0/dist/${a}`}),s=new t.Database;return va(s),s}async function Na(){if(ke)return;const t=await wa(),s=window.fetch.bind(window);window.fetch=async(a,r)=>{const n=new Request(a,r),o=new URL(n.url,window.location.origin);if(!o.pathname.startsWith(V))return s(a,r);const i=ja(o),l=n.method.toUpperCase();if(l==="GET"&&i===`${V}/ping`)return new Response("pong",{status:200});if(l==="GET"&&i===`${V}/badges`)return F(200,["fri3d-badge"]);if(l==="GET"&&i===`${V}/categories`)return F(200,["tools"]);if(l==="GET"&&i===`${V}/stats`)return F(200,{total_projects:1,total_installs:0});if(l==="GET"&&i===`${V}/project-summaries`){const x=ya(t,"SELECT * FROM projects ORDER BY updatedAt DESC").map(ut);return F(200,x)}const h=i.match(/^\/api\/v3\/projects\/([^/]+)$/);if(h&&l==="GET"){const x=decodeURIComponent(h[1]),c=ce(t,"SELECT * FROM projects WHERE slug = ?",[x]);return c?F(200,De(c)):F(404,{reason:"Project not found"})}if(h&&l==="POST"){const x=decodeURIComponent(h[1]),c=await n.json(),g=new Date().toISOString(),y={name:c.name??x,description:c.description??"",category:c.category??"tools",badges:c.badges??["fri3d-badge"],author:"preview-user"};return t.run(`INSERT INTO projects (slug, name, description, category, badges, authorId, metadataJson, updatedAt, createdAt)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,[x,String(y.name),String(y.description),String(y.category),JSON.stringify(y.badges),"preview-user",JSON.stringify(y),g,g]),Oe()}const p=i.match(/^\/api\/v3\/projects\/([^/]+)\/draft$/);if(p&&l==="GET"){const x=decodeURIComponent(p[1]),c=ce(t,"SELECT * FROM projects WHERE slug = ?",[x]);return c?F(200,De(c)):F(404,{reason:"Project not found"})}const b=i.match(/^\/api\/v3\/projects\/([^/]+)\/publish$/);if(b&&l==="PATCH"){const x=decodeURIComponent(b[1]);return t.run("UPDATE projects SET publishedRevision = draftRevision, draftRevision = draftRevision + 1, updatedAt = ? WHERE slug = ?",[new Date().toISOString(),x]),Oe()}const u=i.match(/^\/api\/v3\/projects\/([^/]+)\/latest\/files\/(.+)$/);if(u&&l==="GET"){const x=decodeURIComponent(u[1]),c=decodeURIComponent(u[2]),g=ce(t,"SELECT publishedRevision FROM projects WHERE slug = ?",[x]);if(!g)return F(404,{reason:"Project not found"});const y=ce(t,"SELECT content FROM project_files WHERE slug = ? AND revision = ? AND filePath = ?",[x,g.publishedRevision,c]);return y?new Response(ba.encode(y.content),{status:200}):F(404,{reason:"File not found"})}return F(501,{reason:`Browser backend route not implemented: ${l} ${i}`})},ke=!0}const Ca=()=>{const{slug:t}=$e();return t?e.jsx(Gs,{slug:t}):e.jsx("div",{children:"Error: App slug is required"})},Ea=()=>{const{slug:t}=$e();return re(`Edit project ${t}`),t?e.jsx(ra,{slug:t}):e.jsx("div",{children:"Error: App slug is required"})};async function _a(){await Na(),bt.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(jt,{children:e.jsx(ha,{children:e.jsxs(vt,{children:[e.jsx(z,{path:"/",element:e.jsx(js,{})}),e.jsx(z,{path:"/page/project/:slug",element:e.jsx(Ca,{})}),e.jsx(z,{path:"/page/project/:slug/edit",element:e.jsx(Ea,{})}),e.jsx(z,{path:"/page/my-projects",element:e.jsx(fa,{})}),e.jsx(z,{path:"/page/todo",element:e.jsx(xa,{})}),e.jsx(z,{path:"/page/create-project",element:e.jsx(pa,{})})]})})})}))}_a();
